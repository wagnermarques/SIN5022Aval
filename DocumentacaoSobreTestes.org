#+Title: Documentação Sobre a Realização dos Testes

#+BEGIN_SRC emacs-lisp
(setq org-time-stamp-formats
      '("<%d-%m-%Y-%a>" . "<%Y-%m-%d %a %H:%M:%S>"))
#+END_SRC

#+RESULTS:
: (<%d-%m-%Y-%a> . <%Y-%m-%d %a %H:%M:%S>)


* Pressupostos assumidos
  Considerando que a cobrança é por minuto, é necessário saber se
  frações de minutos serão cobrados ou não.
  
  Por padrão a aplicação tarifa frações de minutos na razão de
  segundos. Isso quer dizer que se uma ligação começa às 7:30h, o
  horário inicial é menor que 8:00h porque, a princípio, faz mais
  sentido. 
  Entretanto, pode ser que se a cobrança é por minuto, minutos
  incompletos poderiam não ser válidos para cobrança o que faz até algum
  sentido também porque um cliente pode dizer que esse minuto incompleto
  poderia não ser tarifado. Nesse caso uma ligação que inicia às 7:30
  poderia ter seu momento de início considerado como sendo 8:00h.
  Portanto, conforme citado, esta aplicação cobra frações de minutos à
  razão de segundos o que na prática pode-se dizer que a cobrança não
  é por minutos, mas por segundos. Entretanto, para que o
  comportamento da aplicação não cobre frações de minutos, ou seja,
  somente minutos cheios, é só passar a opçao
  -DtarifaFracaoDeMinutos=false, por padrão é utilizado true.
  Não tenho certeza no momento em que estou escrevento essa
  documentação se deu tempo de fazer as duas implementações, favor
  consultar o wiki do projeto no github.
  

* Particionamento em classes de equivalência
  
** Identifição do domínio de entrada
   + Momento de inicio da chamada
   + Momento de término da chamada
     
** Implicações sobre o domínio de entrada relevantes para os testes
   + O dominio de entrada define o tipo de ligação
     TarifPadr: Ligação com inicio entre às 8h (inclusive) e 18h (exclusive)
     tarifComDesc: Ligação com início entre às 18h (inclusive) e as 8h
     do dia seguinte (excluse)
     TarifDif: Ligação com início dentro do período ou da TarifPadr ou
     da TarifComDesc mas com término dentro do próximo tipo de tarifação
   + Duração da chamada     
     A Duração da chamada define se a ligação deve sofrer desconto de
     15% na tarifação, independente do tipo de ligação 


** Classes de Equivalência para horário de Tarifa Padrão (TarifPadr)  0.40/min (Sem Desc Adicional)
   M >= 8h e M<18h Cobrança com preço cheio 0,4 p/min
| Variável de Entrada | Classes Eq Válidas | Classes Eq Inválidas |
| Mi                  | Mi>=DD/MM/AA:8h    | Mi <  DD/MM/AA:8h    |
| Mt                  | Mt< DD/MM/AA:18h   | Mt >= DD/MM/AA:18    |
| Du = (Mt-Mi)        | Du < 60            | Du >= 60             |
No caso de Du >= 60 a cobrança já não é mais de 0.40/min e sim 0.40 -
15%/min.
Nesse periodo das 8 até quase 18 com Du < 60 ela nunca sera tagueada
como tag = dif ou tag = comDesc. Por isso considerar essa variável nas
classes de equivalência seria um erro porque é uma redundante.

Um exemplo de ligação é apresentado no abaixo de uma ligação como se inicia no
minuto 40 e dura até o minuto 10 das 9 horas, durando, portanto, 30min.
| h             | 1 | 2 | 3 | 4 | 5 | 6 | 7 |  8 |  9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 |
| minIni/minFin |   |   |   |   |   |   |   | 40 | 10 |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |


| mi | mt | du em Seg | tipo      |        tarifPadr/seg | VlrLigacao | Classe |
|  8 | 59 |      3540 | TarifPadr | 0.006666666666666667 |       23.6 | Valida |
| 17 | 59 |      3540 | TarifPadr | 0.006666666666666667 |       23.6 | Valida |

#+TBLFM: @3$3=@3$2*60::@3$6=@3$3*@3$5::@4$3=@4$2*60::@4$6=@4$3*@4$5
C-u C-c *

>>>>>###[1] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (pegando um vlr tipico de uma classe valida) 
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:TarifPadr
>>>>>2015-11-04T15:00 - 2015-11-04T15:20du=20 VlrEsperado=8.0/VlrObtido=8.0

>>>>>###[2] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (pegando um vlr tipico de uma classe INvalida) 
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:null
>>>>>2015-11-04T19:00 - 2015-11-04T19:20du=20 VlrEsperado=8.0/VlrObtido=0.0

>>>>>###[3] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (Explora vlr limite 8h: Ligacao de 59min que comeca 8h em ponto) 
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:TarifPadr
>>>>>2015-11-04T08:00 - 2015-11-04T08:59du=59 VlrEsperado=23.6/VlrObtido=23.6

>>>>>###[4] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (Explora vlr limite anterior as 8h: Ligacao de 59min que comeca 7h:59min:59Seg
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:TarfComDesc
>>>>>2015-11-04T07:00:58 - 2015-11-04T07:59:58du=59 VlrEsperado=23.6/VlrObtido=11.8

>>>>>###[5] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (Explora vlr limite Posterior 8h: ligacao de 59 min que comeca as 8h:00:01) 
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:TarifPadr
>>>>>2015-11-04T08:00:01 - 2015-11-04T08:59:01du=59 VlrEsperado=23.6/VlrObtido=23.6

>>>>>###[6] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (Explora vlr limite anterior 18h: ligacao de 59 min que termina as 18 menos 1 segundo) 
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:TarifPadr
>>>>>2015-11-04T16:01:01 - 2015-11-04T17:00:01du=59 VlrEsperado=23.6/VlrObtido=23.6

>>>>>###[7] M >= 8h e M<18h CobranÃ§a com preÃ§o cheio 0,4 p/min Sem Desc Adiconal (Explora vlr limite posterior as 18h: ligacao de 59min que termina as 18:00:01)
>>>>> Tipo de Tarifacao esperado = TarifPadr / Obtido:null
>>>>>2015-11-04T17:01 - 2015-11-04T18:00du=59 VlrEsperado=23.6/VlrObtido=0.0






** Classes de Equivalencia para horário de Tarifa Padrão (TafifPadr) + Desconto Adicional
   M >= 8h e M<18h Cobrança com preço cheio 0,4 p/min menos 15% de desconto.
| Variável de Entrada | Classes Eq Válidas | Classes Eq Inválidas |
| Mi                  | Mi>=DD/MM/AA:8h    | Mi <  DD/MM/AA:8h    |
| Mt                  | Mt< DD/MM/AA:18h   | Mt >= DD/MM/AA:18    |
| Du = (Mt-Mi)        | Du > 60            | Du < 60              |
No caso de Du >= 60 a cobrança já não é mais de 0.40/min e sim 0.40 - 15%/min.

| mi | mt | 3660 | tipo      |        tarifPadr/seg | VlrLigacao | Classe |
|  8 | 61 | 3660 | TarifPadr | 0.006666666666666667 |      20.74 | Valida |
| 17 | 61 | 3660 | TarifPadr | 0.006666666666666667 |      20.74 | Valida |
#+TBLFM: $3=@2$2*60::@2$6=@2$3*@2$5-(@2$3*@2$5*0.15)::@3$3=@3$2*60::@3$6=@3$3*@3$5-(@3$3*@3$5*0.15)


** Classes de Equivalência para horário de Tarifa com Desconto (TarifComDesc) Sem Desc Adic de 50% 
| Variável de Entrada | Classes Eq Válidas                            | Classes Eq Inválidas                        |
| Mi                  | DD/MM/AA:18:00:00 <= Mi < DD+1/MM/AA:08:00:00 | DD/MM/AA:08:00:00 <= Mi < DD/MM/AA:18:00:00 |
| Mt                  | DD/MM/AA:18:00:01 <= Mt < DD+1/MM/AA:08:00:00 | DD/MM/AA:08:00:00 <= Mt < DD/MM/AA:18:00:00 |
| Du = (Mt-Mi)        | Du < 60                                       | Du < 60                                     |

** Classes de Equivalência para horário de tarifa com desconto (TafifComDesc + DescAdicional) de 50% 
    Mi >=8 e Mt > 18h
| Variável de Entrada | Classes Eq Válidas | Classes Eq Inválidas |
| Mi                  | Mi>=DD/MM/AA:8h    | Mi <  DD/MM/AA:8h    |
| Mt                  | Mt< DD/MM/AA:18h   | Mt >= DD/MM/AA:18    |
| Du = (Mt-Mi)        | Du > 60            | Du < 60              |

 C-u C-u C-c . (Insere timestamp)
 C-u C-c * (Recalcula tabela)
 C-' (Editar formula)


** Classes de Equivalência para horário de tarifa diferencial (TarifDif)
*** Para o caso de inicio na tarifa com desconto e termino na tarifa padrao  (Vice)
    Mi >= 18h e Mt > 8h 
| Variável de Entrada | Classes Eq Válidas | Classes Eq Inválidas |
| Mi                  | Mi >= DD/MM/AA:18h | Mi >= DD/MM/AA:8h    |
| Mt                  | Mt >= DD/MM/AA:8h  | Mt qualquer          |
| Du = (Mt-Mi)        | Du < 60            | Du > 60              |

*** Para o caso de inicio na tarifa padrao e término na tarifa com desconto (Versa)
    Mi >=8 e Mt > 18h
| Variável de Entrada | Classes Eq Válidas | Classes Eq Inválidas |
| Mi                  | Mi>=DD/MM/AA:8h    | Mi <  DD/MM/AA:8h    |
| Mt                  | Mt< DD/MM/AA:18h   | Mt >= DD/MM/AA:18    |
| Du = (Mt-Mi)        | Du < 60            | Du > 60              |



* Casos de testes

#+TBLFM: $4=$3-$2::@2$4=@2$3-@2-$1



* Informações para realização do cálculo da tarifa paga

| Inicio: DD/MM/AA | Início: Horario | Término: DD/MM/AA | Término: Horario | Vlr |
|                  |                 |                   |                  |     |

  o

